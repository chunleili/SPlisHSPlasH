## 实现：局部高粘性

日期：2022-05-24

### 目标

一部分粒子是高粘度的（如粘度为100），另一部分为低粘度的（如粘度为0.01），两者能够共存。

### 要求

1. 某区域流体为高粘度，而其他区域仍为正常粘度。

2. 需要测试该区域粒子粘度数值是否为连续非负的。即不可以出现负数、孤立值（与周围数值差距过大）。

### 途径

#### 建立viscosityField

建立变量成员viscosityField，该变量为real vector，每个粒子均有，表示不同粒子的粘度。(已经实现）

#### 建立theRegion

设定一个固定区域，命名为theRegion。该区域为长方体，大小可初步设定为0.3，0.3，0.3。

#### 区域内局部粘度

当粒子进入该该区域时，随时间调大其粘度。如原本粘度为0.01，则进入区域后粘度为
```cpp
viscosityField = 0.01 + residentTime * increaseRate 
if viscosityField > 100.0
    viscosityField = 100.0
```

其中residentTime为粒子在该区域内停留的时间。increaseRate为增长率，可初步设定为10。

同时保证一个上界100.0，防止无限度增长。

请勿硬编码。将上面的数字替换为const变量，或用户可输入的参数。



注意粒子对于该区域是可进可出的。因此处于动态变化中。要在每个step函数中都先进行判断。



#### 软边界（padding)

在粘性边界处，为了保证不出现硬边界造成数值不稳定，我们应将其改为软边界。

即设定一个缓冲区，我们暂时称之为padding region。padding该词的本意是打印时候的页边距。我们在此设定软边界的意思就是在padding内粘性是线性变化的。

例如某区域内的粘性为100，外界为0.01。这就会造成差距过大，数值不稳定。因此预设一个padding。比如凝固区域x范围为0.3~0.6，则paddingSize可设定为0.03。当x坐标处于0.27~0.3或者0.3~0.33的时候，粘性线性地从0.01变化到100。对y和z也同理。

开始时，请尝试大一些的paddingSize以保证缓冲区足够大。比如初始可尝试缓冲区不是10%，而是200%。



#### 替换原本粘度

在应使用原本粘度m_viscosity的地方替换为viscosityField。从而将粘度转换为粘性力真正施加到粒子上。















